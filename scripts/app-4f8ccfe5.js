angular.module("etyssaDeck",["ngEtyssa.services","ngStorage","ngAnimate","ngCookies","ngTouch","ngSanitize","ngResource","ui.router","ui.bootstrap"]).config(["etyssaApiProvider",function(t){t.API_HOST="http://api.scriptysse.fr",t.TOKEN="a5ec51cb-8590-4a50-b797-9fbbaf50854a",t.EMAIL="olivoelement",t.PASSWORD="coucou"}]),function(){"use strict";function t(t,e){var n=this;n.columns=e.list,n.askForNewColumn=e.askForNewColumn,e.list<=0&&n.askForNewColumn(),n.delete=e.delete,n.configure=e.configure}angular.module("etyssaDeck").controller("MainCtrl",["$scope","columnFactory",t])}(),angular.module("etyssaDeck").directive("scrollIf",function(){function t(t,e){t.$watch("scrollIf",function(){t.scrollIf&&window.scrollTo(e[0].offsetLeft-70,0)})}return{restrict:"A",scope:{scrollIf:"="},link:t}}).directive("fullHeight",["$window","$timeout","columnFactory",function(t,e){"use strict";var n=function(n,a){var o=0,c=function(){e(function(){a.height(angular.element(t).height()-a.offset().top-o)})};c(),angular.element(t).bind("resize",c)};return{restrict:"A",link:n}}]),function(){"use strict";function t(t,e,n,a,o){var c=this;"undefined"!=typeof o?c.column=o:(c.column={},c.column.params={}),c.categories=a.categories.query(),c.ok=function(){c.column.$$hashKey||n.create(c.column),e.close()},c.cancel=e.close}angular.module("etyssaDeck").controller("NewColumnModalInstanceCtrl",["$scope","$modalInstance","columnFactory","etyssaApi","columnInstance",t])}(),function(){"use strict";function t(t,e){function n(n){n.loading=!0,n.title=n.column.get_title(),n.delete=t.delete,n.configure=t.configure,n.contact=function(t){t.content_type=n.column.content_type,t.column=n.column,e.open_modal(t)},n.remove_entry=function(t){if("inbox"==n.column.content_type){var a=n.column.entries[t];e.delete(a)}else"entries"==n.column.content_type;n.column.entries.splice(t,1)},n.$watchCollection("column.params",function(){n.column.update_entries().$promise.then(function(t){n.column.entries=t,n.loading=!1})})}return{restrict:"E",templateUrl:"app/columnar/column.html",controller:["$scope",n],scope:{column:"=columnarColumn"}}}angular.module("etyssaDeck").directive("columnar",["columnFactory","contactFactory",t])}(),function(){"use strict";function t(t,e,n,a){function o(e,a){"inobx"==e&&(e="inbox");var o={entries:function(e){return{template_url:"app/columnar/entries-column.html",update_entries:function(){var n;return e.cat&&(n=e.cat.alias),t.entries.query({cat:n,tag:e.tag,to_address:e.to_address})},get_title:function(){return n("colTitleFromParams")(e)}}},inbox:function(){return{template_url:"app/columnar/inbox-column.html",get_title:function(){return"Messages"},update_entries:function(){return t.message.query({mailbox:"inbox",timestamp:(new Date).getTime()})}}}}[e](a);return o.content_type=e,o.params=a,o.get_index=function(){return r.indexOf(this)},o}function c(t){e.open({templateUrl:"app/main/new-column.modal.html",controller:"NewColumnModalInstanceCtrl as modal",resolve:{columnInstance:function(){return r[t]}}})}var l=a.$default({columns:[]}),r=l.columns;return _.forEach(r,function(t,e){r[e]=o(t.content_type,t.params)}),{create:function(t){var e=t.params||{};e.limit=t.params.limit||50;var n=o(t.content_type,t.params);return r.push(n),n},list:r,"delete":function(t){r.splice(t,1)},askForNewColumn:c,configure:function(t){c(t)},pushMessage:function(t){for(var e=0;e<r.length;e++){var n=r[e];"inbox"==n.content_type&&n.entries.unshift(t)}}}}function e(){return function(t){var e="";return t.to_address&&(""!==e&&(e+=" | "),e+=t.to_address),t.cat&&(""!==e&&(e+=" | "),e+=t.cat.title),t.tag&&(""!==e&&(e+=" | "),e+=t.tag),""===e&&(e="Accueil"),e}}angular.module("etyssaDeck").factory("columnFactory",["etyssaApi","$modal","$filter","$localStorage","contactFactory",t]).filter("colTitleFromParams",e)}(),function(){"use strict";function t(t,e,n,a){function o(t){var e={};"entries"==t.content_type?e=c(t):"inbox"==t.content_type&&(e=l(t)),r(e)}function c(e){if(null==e)return{};var n=e;return n.user=t.users.get({user_id:e.creator}),n.entry=e,n.entry_id=e.id,n.subject=e.id,n.receiver=e.creator,n}function l(e){if(null==e)return{};var n=e;return n.user=t.users.get({user_id:e.sender}),n.subject=e.subject,u(e.subject)&&(n.entry_id=e.id,n.entry=t.entries.get({entry_id:e.id})),n.message=e.id,n.receiver=e.receiver,n}function r(t){e.open({templateUrl:"app/contact/modal.html",controller:"NewContactModalInstanceCtrl as contact",resolve:{contactInstance:function(){return t}}})}function i(e){t.message.delete({message:e})}function s(e){var n=t.message.save(e);return n}function u(t){return parseInt(t,10)===t}var d=a.$default({contacts:[]}),m=d.contacts;return _.forEach(m,function(t,e){m[e]=create_contact_form(t)}),{open_modal:o,send:s,"delete":i}}angular.module("etyssaDeck").factory("contactFactory",["etyssaApi","$modal","$filter","$localStorage",t])}(),function(){"use strict";function t(t,e){var n=this;n.send=function(){e.send_message(n)}}angular.module("etyssaDeck").controller("ContactCtrl",["$scope","contactFactory",t])}(),function(){"use strict";function t(t,e,n,a,o,c){var l=this;"undefined"!=typeof c&&(l=_.merge(l,c)),l.next=function(){},l.send=function(){n.send(l);e.close()},l.cancel=e.close}angular.module("etyssaDeck").controller("NewContactModalInstanceCtrl",["$scope","$modalInstance","contactFactory","etyssaApi","columnFactory","contactInstance",t])}(),function(t){try{t=angular.module("etyssaDeck")}catch(e){t=angular.module("etyssaDeck",[])}t.run(["$templateCache",function(t){t.put("app/columnar/column.html",'<div class="stack__wrapper"><div class="stack__header"><div class="btn-group" dropdown="" is-open="status.isopen"><button type="button" class="btn btn-primary dropdown-toggle" dropdown-toggle="" ng-disabled="disabled">{{ column.get_index() + 1 }}</button><ul class="dropdown-menu" role="menu"><li><a href="#" ng-click="delete(column.get_index())">Supprimer</a></li><li><a href="#" ng-click="configure(column.get_index())">Paramètres</a></li></ul></div><div class="stack__header__title">{{ column.get_title() }}</div></div><div class="stack__body" full-height=""><div ng-repeat="entry in column.entries" class="stack__entry"><div ng-include="column.template_url" ng-click="contact(entry)"></div></div><div ng-if="loading">Chargement ...</div><div ng-if="column.entries.length < 1 && !loading">Pas de résultats</div></div></div>')}])}(),function(t){try{t=angular.module("etyssaDeck")}catch(e){t=angular.module("etyssaDeck",[])}t.run(["$templateCache",function(t){t.put("app/columnar/entries-column.html",'<div class="entry__wrapper"><div class="entry__date" ng-bind-html="entry.publish_since_text"></div><div class="entry__username" ng-bind-html="entry.creator_nickname"></div><div class="entry__title" ng-bind-html="entry.smart_title"></div><div class="entry__detail" ng-bind-html="entry.detail"></div><div class="entry__file"><img ng-src="{{entry.file.file_display_url}}&width=200"></div></div>')}])}(),function(t){try{t=angular.module("etyssaDeck")}catch(e){t=angular.module("etyssaDeck",[])}t.run(["$templateCache",function(t){t.put("app/columnar/inbox-column.html",'<div class="entry__date" ng-bind-html="entry.publish_since_text"></div><div class="entry__username" ng-bind-html="entry.sender_nickname"></div><div class="entry__detail" ng-bind-html="entry.body"></div>')}])}(),function(t){try{t=angular.module("etyssaDeck")}catch(e){t=angular.module("etyssaDeck",[])}t.run(["$templateCache",function(t){t.put("app/contact/modal.html",'<div class="modal-header"><div class="row"><div class="col-md-3"><img class="avatar left" ng-if="contact.user.email_hash" ng-src="http://www.gravatar.com/avatar/{{contact.user.email_hash}}?d=retro"></div><div class="col-md8">{{contact.user.nickname}} A propos de : {{ contact.subject }}<h3>{{contact.subject.category.title}}</h3><div class="entry__file"><img ng-src="{{contact.entry.file.file_display_url}}&width=200"></div></div><a nbclick="next()"></a></div></div><div class="modal-body"><div class="entry__messages" ng-bind-html="contact.entry.messages"></div><form role="form"><div class="form-group"><label for="addressInput">Votre message</label> <input type="text" ng-model="contact.body" class="form-control" id="addressInput" placeholder="Bonjour, "></div></form></div><div class="modal-footer"><button class="btn btn-primary" ng-click="contact.send()">Envoyer</button> <button class="btn btn-warning" ng-click="contact.cancel()">Annuler</button></div>')}])}(),function(t){try{t=angular.module("etyssaDeck")}catch(e){t=angular.module("etyssaDeck",[])}t.run(["$templateCache",function(t){t.put("app/main/main.html",'<div><div class="board" ng-style="{width: (main.columns.length * 400) + (main.columns.length * 40) + 120}"><div ng-repeat="column in main.columns" class="stack" ng-class="{active: main.selectedColumn === column}" scroll-if="main.selectedColumn == column"><columnar columnar-column="column"></columnar></div></div></div>')}])}(),function(t){try{t=angular.module("etyssaDeck")}catch(e){t=angular.module("etyssaDeck",[])}t.run(["$templateCache",function(t){t.put("app/main/new-column.modal.html",'<div class="modal-header"><h3>Nouvelle colonne</h3></div><div class="modal-body"><form role="form"><div class="form-group" ng-if="!modal.column.$$hashKey"><label for="inputContentType">Quelle contenu ?</label><div class="form-group"><label class="btn btn-primary" ng-model="modal.column.content_type" btn-radio="\'entries\'">Annonces</label> <label class="btn btn-primary" ng-model="modal.column.content_type" btn-radio="\'inbox\'">Messages</label></div></div><div ng-if="modal.column.content_type == \'entries\'"><div class="form-group"><label for="addressInput">Adresse</label> <input type="text" ng-model="modal.column.params.to_address" class="form-control" id="addressInput" placeholder="issy?"></div><div class="form-group"><label for="categoryInput">Catégorie</label><select class="form-control" ng-model="modal.column.params.cat" ng-options="cat as (cat.title + \' (\' + cat.service_count + \')\') for cat in modal.categories"><option value="">-- Choisissez une catégorie --</option></select></div><div class="form-group"><label for="tagInput">Mots clés</label> <input type="text" class="form-control" ng-model="modal.column.params.tag" id="tagInput" placeholder="tennis, poney, partage"></div></div><div ng-if="modal.column.content_type == \'inbox\'">Une colonne messagerie va être ajoutée.</div></form></div><div class="modal-footer"><button class="btn btn-primary" ng-click="modal.ok()" ng-disabled="!modal.column.content_type">OK</button> <button class="btn btn-warning" ng-click="modal.cancel()">Annuler</button></div>')}])}(),function(t){try{t=angular.module("etyssaDeck")}catch(e){t=angular.module("etyssaDeck",[])}t.run(["$templateCache",function(t){t.put("app/navbar/navbar.html",'<div class="navigation" full-height=""><div class="btn-group-vertical btn-group-lg" role="group" aria-label="..."><div ng-repeat="col in main.columns" class="btn-group" dropdown="" is-open="status.isopen"><button type="button" class="btn btn-primary dropdown-toggle" ng-click="main.selectedColumn = col" dropdown-toggle="" ng-disabled="disabled">{{ col.get_index() + 1 }}</button><ul class="dropdown-menu" role="menu"><li><a href="#" ng-click="main.delete(col.get_index())">Supprimer</a></li><li><a href="#" ng-click="main.configure(col.get_index())">Paramètres</a></li></ul></div></div></div><div class="navigation-right"><button type="button" class="btn btn-danger btn-circle btn-lg" ng-click="main.askForNewColumn()">+</button></div>')}])}();